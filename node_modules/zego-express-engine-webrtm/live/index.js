!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r,i=t();for(r in i)("object"==typeof exports?exports:e)[r]=i[r]}}("undefined"!=typeof self?self:this,(function(){return t={24:function(e,t,r){"use strict";function i(e){return e}r.r(t),(r=o=o||{}).LIVE_SEND_SIGNAL="zm.lv.ssg",r.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",r.LIVE_PUSH_SIGNAL="zm.lv.pss",r.SERVICE_PUSH="zm.sv.ps",r.SERVICE_SEND="zm.sv.sd";var o,n={event:"/liveroom/send_end_join_live",to_user_id:i,request_id:i},s={event:"/liveroom/send_invite_join_live",to_user_id:i,request_id:i},u={event:"/liveroom/send_join_live_result",to_user_id:i,request_id:i,join_result:function(e){return e}},a={event:"/liveroom/send_request_join_live",to_user_id:i,request_id:i},l={code:1002014,msg:"room not exist"},d={code:1002099,msg:"room inner error"},v=(h.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},h.prototype.getSignalCmdContent=function(e,t,r){return e={request_id:e,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t},null!=r&&(e.result=r),JSON.stringify(e)},h.prototype.requestJoinLive=function(e,t,r,i){var o,n=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(n,e);return null!=i&&(this.stateCenter.reporter.spanSetAttributes({key:a.event,par:null==(o=this.room)?void 0:o.roomID},{request_id:a.request_id(n)}),this.joinLiveCallbackMap[n]=i,this.sendSignalCmd(1001,s,e,t,r),!0)},h.prototype.sendSignalCmd=function(e,t,r,i,n){var s=this;this.room.isLogin()?((this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendSignalCmd({sub_cmd:e,signal_msg:t,dest_id_name:[r]},(function(e){i&&i(e.header.seq)}),(function(e){var t=d;e.header&&e.body?n&&n(s.rtm.getServerError(e.body.err_code),e.header.seq):(e.code&&e.msg&&(t=e),n&&n(t,0))}),this.room),this.logger.info(o.LIVE_SEND_SIGNAL+" call success"+e)):this.logger.error(o.LIVE_SEND_SIGNAL+" state error")},h.prototype.inviteJoinLive=function(e,t,r,i){var o,n=this.stateCenter.getRequestId(),u=this.getSignalCmdContent(n,e);return null!=i&&(this.stateCenter.reporter.spanSetAttributes({key:s.event,par:null==(o=this.room)?void 0:o.roomID},{request_id:s.request_id(n)}),this.joinLiveCallbackMap[n]=i,this.sendSignalCmd(1003,u,e,t,r),!0)},h.prototype.endJoinLive=function(e,t,r){var i,o=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(o,e);return this.stateCenter.reporter.spanSetAttributes({key:n.event,par:null==(i=this.room)?void 0:i.roomID},{request_id:n.request_id(o)}),this.sendSignalCmd(1004,s,e,t,r),!0},h.prototype.respondJoinLive=function(e,t,r,i){var n=this.joinLiveRequestMap[e];if(!n)return this.logger.info(o.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;this.stateCenter.reporter.spanSetAttributes({key:u.event,par:null==(s=this.room)?void 0:s.roomID},{to_user_id:u.to_user_id(n)});var s=0;t=this.getSignalCmdContent(e,n,s=!0===t?1:s);return this.sendSignalCmd(1002,t,n,r,i),delete this.joinLiveRequestMap[e],!0},h.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(o.LIVE_PUSH_SIGNAL+" hpsm= ",t),e.body.sub_cmd){case 11001:this.handlePushJoinLiveRequestMsg(t);break;case 11002:this.handlePushJoinLiveResultMsg(t);break;case 11003:this.handlePushJoinLiveInviteMsg(t);break;case 11004:this.handlePushJoinLiveStopMsg(t)}},h.prototype.handlePushJoinLiveRequestMsg=function(e){var t,r=e.request_id;"string"!=typeof r?this.logger.error(o.LIVE_PUSH_SIGNAL+" no requestId"):"string"!=typeof(t=e.from_userid)?this.logger.error(o.LIVE_PUSH_SIGNAL+" no from user"):(this.joinLiveRequestMap[r]=t,this.onRecvJoinLiveRequest(r,e.from_userid,e.from_username,e.room_id),this.logger.info(o.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+t))},h.prototype.onRecvJoinLiveRequest=function(e,t,r,i){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,r,i)},h.prototype.handlePushJoinLiveInviteMsg=function(e){var t,r=e.request_id;"string"!=typeof r?this.logger.error(o.LIVE_PUSH_SIGNAL+"no requestId"):"string"!=typeof(t=e.from_userid)?this.logger.error(o.LIVE_PUSH_SIGNAL+" no from user"):(this.joinLiveRequestMap[r]=t,this.onRecvInviteJoinLiveRequest(r,e.from_userid,e.from_username,e.room_id),this.logger.info(o.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+t))},h.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,i){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,r,i)},h.prototype.handlePushJoinLiveResultMsg=function(e){var t,r,i=e.request_id;"string"!=typeof i?this.logger.error(o.LIVE_PUSH_SIGNAL+" no requestId"):null==(t=e.result)?this.logger.info(o.LIVE_PUSH_SIGNAL+" no result"):(t=1==t,this.joinLiveCallbackMap[i]&&((r=this.joinLiveCallbackMap[i])?(this.logger.info(o.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+t),delete this.joinLiveCallbackMap[i],r(t,e.from_userid,e.from_username)):this.logger.info(o.LIVE_PUSH_SIGNAL+" no callback")))},h.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"!=typeof t?this.logger.error(o.LIVE_PUSH_SIGNAL+" no requestId"):(this.logger.info(o.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id))},h.prototype.onRecvEndJoinLiveCommand=function(e,t,r,i){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,r,i)},h);function h(e,t,r,i,o,n){this.logger=e,this.stateCenter=t,this.service=r,this.liveRoomHandler=i,this.rtm=o,this.room=n,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}var _={requestJoinLive:function(e,t,r,i,o){var n=this,s=this.getMsgSpan(a.event,o||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return u?(s.setAttributes({to_user_id:a.to_user_id(e)}),u.liveHandler.requestJoinLive(e,(function(e){s.end(),t(e)}),(function(e,t){n.stateCenter.reporter.setError(s,e),r(e,t)}),i)):(this.stateCenter.reporter.setError(s,l),r&&r(l,0),!1)},inviteJoinLive:function(e,t,r,i,o){var n=this,u=this.getMsgSpan(s.event,o||(null==(a=this.stateCenter.roomModulesList[0])?void 0:a.roomID),!0),a=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return a?(u.setAttributes({to_user_id:s.to_user_id(e)}),a.liveHandler.inviteJoinLive(e,(function(e){u.end(),t(e)}),(function(e,t){n.stateCenter.reporter.setError(u,e),r(e,t)}),i)):(this.stateCenter.reporter.setError(u,l),r&&r(l,0),!1)},endJoinLive:function(e,t,r,i){var o=this,s=this.getMsgSpan(n.event,i||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return u?(s.setAttributes({to_user_id:n.to_user_id(e)}),u.liveHandler.endJoinLive(e,(function(e){s.end(),t(e)}),(function(e,t){o.stateCenter.reporter.setError(s,e),r(e,t)}))):(this.stateCenter.reporter.setError(s,l),r&&r(l,0),!1)},respondJoinLive:function(e,t,r,i,o){var n=this,s=this.getMsgSpan(u.event,o||(null==(a=this.stateCenter.roomModulesList[0])?void 0:a.roomID),!0),a=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];return a?(s.setAttributes({request_id:u.request_id(e),join_result:u.join_result(t)}),a.liveHandler.respondJoinLive(e,t,(function(e){s.end(),r(e)}),(function(e,t){n.stateCenter.reporter.setError(s,e),i(e,t)}))):(this.stateCenter.reporter.setError(s,l),i&&i(l,0),!1)}},f={handlePushSignalMsg:function(e){var t=null==(r=null==e?void 0:e.header)?void 0:r.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==t}));r?r.liveHandler.handlePushSignalMsg(e):this.logger.error(o.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}},p={initLiveHandler:function(){this.liveHandler=new v(this.logger,this.stateCenter,this.service,this.liveRoomHandler,this.rtm,this)}};t.default={type:"live",install:function(e,t,r,i){for(var o in _)Object.defineProperty(e.prototype,o,{value:_[o],writable:!1});for(var o in f)Object.defineProperty(r.prototype,o,{value:f[o],writable:!1}),Object.defineProperty(i.prototype,o,{value:f[o],writable:!1});for(var o in p)Object.defineProperty(t.prototype,o,{value:p[o],writable:!1})}}}},r={},e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:i})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)e.d(i,o,function(e){return t[e]}.bind(null,o));return i},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=24);function e(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t,r}));